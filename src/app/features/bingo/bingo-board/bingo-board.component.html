<div class="bingo-screen">

  <div *ngIf="demoMode" style="margin-bottom:12px; color:#555;">
    <strong class="demo-mode">Demo mode:</strong> Numbers are auto-marked so you can see how bingo works.<br>
    Click <button class="start-game-btn" (click)="startGame()">Start Game</button> to play manually.
  </div>

<div class="caller-box">
  <div class="current-number">
    <p class="label">Now Calling</p>
    <div class="number-ball">
      {{ currentNumber || 'â€”' }}
    </div>
  </div>

  <div class="powerup-bar">
    <button
      class="powerup-btn"
      (click)="activateFreeDaub()"
      [disabled]="(boosterInventory?.freeDaubTokens ?? 0) === 0">
      Free Daub ({{ boosterInventory?.freeDaubTokens ?? 0 }})
    </button>

    <button class="powerup-btn" (click)="activateReveal()">Reveal 3</button>

    <button
      class="powerup-btn"
      [class.active]="autoDaubActive"
      (click)="activateAutoDaub()"
      [disabled]="(boosterInventory?.autoDaubBoosts ?? 0) === 0">
      Auto Daub (30s) ({{ boosterInventory?.autoDaubBoosts ?? 0 }})
    </button>
  </div>

  <div class="booster-shop" *ngIf="playerId">
    <div class="booster-offer">
      <div>
        <p class="booster-name">Free Daub Token</p>
        <p class="booster-cost">Cost: 150 coins</p>
      </div>
      <button
        class="booster-buy"
        (click)="purchaseBooster('free-daub')"
        [disabled]="boosterLoading">
        Buy
      </button>
    
      <div>
        <p class="booster-name">Auto-Daub Boost</p>
        <p class="booster-cost">Cost: 1 gem</p>
      </div>
      <button
        class="booster-buy"
        (click)="purchaseBooster('auto-daub')"
        [disabled]="boosterLoading">
        Buy
      </button>
    </div>
    <p class="booster-status" *ngIf="boosterStatus">{{ boosterStatus }}</p>
  </div>

  <div *ngIf="revealedNumbers.length > 0" class="reveal-box">
    <p>Upcoming Numbers:</p>
    <div class="reveal-list">
      <div *ngFor="let n of revealedNumbers" class="reveal-ball">{{ n }}</div>
    </div>
  </div>
  
</div>

<div style="margin-top: -50px;">
  <div class="history-box">
      <p class="label">Previous Numbers</p>
      <div class="history-strip">
        <div *ngFor="let num of callHistory" class="history-ball">
          {{ num }}
        </div>
      </div>
  </div>
</div>

  

<div class="multi-card-container">
  <div class="bingo-card" *ngFor="let card of cards; let i = index">
    <div class="card-title">Card {{ i + 1 }}</div>

    <div class="bingo-grid">
      <div *ngFor="let row of card" class="row">
        <div
          *ngFor="let num of row"
          class="cell"
          [class.marked]="isMarked(num, i)"
          (click)="toggleMark(num, i)"
        >
          {{ num }}
        </div>
      </div>
    </div>

    <!-- Show BINGO! overlay/message if this card has bingo and not yet claimed -->
    <div *ngIf="bingoDetected[i] && !claimedCards[i]" class="bingo-indicator">
      ðŸŽ‰ <strong>BINGO!</strong> <br>
      <button class="win-btn" (click)="claimReward(i)">Claim Reward</button>
    </div>
    <!-- Show claimed message if already claimed -->
    <div *ngIf="claimedCards[i]" class="claimed-indicator">
      âœ… Reward claimed!
    </div>
  </div>
</div>

  <div *ngIf="rewardModalVisible && reward" class="reward-overlay">
    <div class="reward-modal">
      <p class="reward-label">Bingo Reward</p>
      <h2>{{ reward.name }}</h2>
      <div class="reward-art">
        <img
          *ngIf="reward.imageUrl"
          [src]="closetService.getImageSrc(reward)"
          [alt]="reward.name"
          [ngClass]="{
            'gold-skirt': reward?.name === 'Gold Skirt',
            'pink-tee': reward?.name === 'T Shirt',
            'sparkles': reward?.name === 'Sparkles',
            'silver-bag': reward?.name === 'Silver Bag',
            'neon-sneakers': reward?.name === 'Sneakers'
          }">
        <div *ngIf="!reward.imageUrl" class="reward-placeholder">{{ reward.type }}</div>
      </div>
      <!-- <p class="reward-rarity">Rarity: {{ reward.rarity }}</p> -->
      <p class="reward-message">{{ rewardDeliveryMessage }}</p>
      <button class="win-btn" (click)="closeRewardModal()">Back to Bingo</button>
    </div>
  </div>
</div>
