<div class="bingo-screen">

<div class="caller-box">
  <div class="current-number">
    <p class="label">Now Calling</p>
    <div class="number-ball">
      {{ currentNumber || '—' }}
    </div>
  </div>

  <div class="daub-buttons">
    <div class="daub-offer">
      <button
        class="powerup-btn"
        (click)="activateFreeDaub()"
        [disabled]="(boosterInventory?.freeDaubTokens ?? 0) === 0">
        Free Daub
        <br> ({{ boosterInventory?.freeDaubTokens ?? 0 }})
      </button>
    </div>
    <div class="daub-offer">  
      <button
        class="powerup-btn"
        [class.active]="autoDaubActive"
        (click)="activateAutoDaub()"
        [disabled]="(boosterInventory?.autoDaubBoosts ?? 0) === 0">
        Auto Daub 
        <br> (30s) ({{ boosterInventory?.autoDaubBoosts ?? 0 }})
      </button>  
    </div>  
  </div>

  <div class="powerup-bar">
    <button class="powerup-btn" (click)="activateReveal()">Reveal 3</button>
  </div>

  <div class="daub-buttons">
    <div class="daub-offer">
      <button class="deposit-btn" type="button" (click)="openDepositModal()">Deposit Funds</button>
    </div>
    <div class="daub-offer">  
      Bank Balance: 
    </div>  
  </div>

  <div class="booster-shop" *ngIf="playerId">
    <div class="booster-offer">
      <div>
        <p class="booster-name">Free Daub Token</p>
        <p class="booster-cost">Cost: 150 coins</p>
      </div>
      <button
        class="booster-buy"
        (click)="purchaseBooster('free-daub')"
        [disabled]="boosterLoading">
        Buy
      </button>
      </div>
    <div class="booster-offer">
      <div>
        <p class="booster-name">Auto-Daub Boost</p>
        <p class="booster-cost">Cost: 1 gem</p>
      </div>
      <button
        class="booster-buy"
        (click)="purchaseBooster('auto-daub')"
        [disabled]="boosterLoading">
        Buy
      </button>
    </div>
    <p class="booster-status" *ngIf="boosterStatus">{{ boosterStatus }}</p>
  </div>

  <div *ngIf="revealedNumbers.length > 0" class="reveal-box">
    <p>Upcoming Numbers:</p>
    <div class="reveal-list">
      <div *ngFor="let n of revealedNumbers" class="reveal-ball">{{ n }}</div>
    </div>
  </div>
  
</div>

<div class="history-box">
  <p class="label" style="color: black;">Previous Numbers</p>
  <div class="history-strip">
    <div *ngFor="let num of callHistory" class="history-ball">
      {{ num }}
    </div>
  </div>
</div>

  

<div class="multi-card-container">
  <div class="bingo-card" *ngFor="let card of cards; let i = index">
    <div class="card-title">Card {{ i + 1 }}</div>

    <div class="bingo-grid">
      <div *ngFor="let row of card" class="row">
        <div
          *ngFor="let num of row"
          class="cell"
          [class.marked]="isMarked(num, i)"
          (click)="toggleMark(num, i)"
        >
          {{ num }}
        </div>
      </div>
    </div>

    <!-- Show BINGO! overlay/message if this card has bingo and not yet claimed -->
    <div *ngIf="bingoDetected[i] && !claimedCards[i]" class="bingo-indicator">
      <div
        class="reward-lady"
        role="button"
        tabindex="0"
        (click)="claimReward(i)"
        (keyup.enter)="claimReward(i)"
        (keyup.space)="claimReward(i)">
        <img src="/assets/fashion-lady.png" alt="Stylish player holding reward ticket" />
        <div class="reward-sign">
          <span>Claim Reward</span>
        </div>
      </div>
    </div>
    <!-- Show claimed message if already claimed -->
    <div *ngIf="claimedCards[i]" class="claimed-indicator">
      ✅ Reward claimed!
    </div>
  </div>
</div>

  <div class="demo-lady-banner" *ngIf="demoMode" aria-hidden="true">
    <div class="demo-lady">
      <img src="/assets/tulle-lady.png" alt="" />
      <div class="demo-sign">
        <span>Demo Mode · Press</span>
        <button class="start-game-btn" type="button" (click)="startGame()" [disabled]="!demoMode">Start Game</button>
        <span>to play</span>
      </div>
    </div>
  </div>

</div>

<div *ngIf="rewardModalVisible && reward" class="reward-overlay">
  <div class="reward-modal">
    <p class="reward-label">Bingo Reward</p>
    <h2>{{ reward.name }}</h2>
    <div class="reward-art">
      <img
        *ngIf="reward.imageUrl"
        [src]="closetService.getImageSrc(reward)"
        [alt]="reward.name"
        [ngClass]="{
          'gold-skirt': reward?.name === 'Gold Skirt',
          'pink-tee': reward?.name === 'T Shirt',
          'sparkles': reward?.name === 'Sparkles',
          'silver-bag': reward?.name === 'Silver Bag',
          'neon-sneakers': reward?.name === 'Sneakers'
        }">
      <div *ngIf="!reward.imageUrl" class="reward-placeholder">{{ reward.type }}</div>
    </div>
    <p class="reward-message">{{ rewardDeliveryMessage }}</p>
    <button class="win-btn" (click)="closeRewardModal()">Back to Bingo</button>
  </div>
</div>

<div *ngIf="depositModalVisible" class="deposit-overlay">
  <div class="deposit-modal">
    <button class="modal-close" type="button" (click)="closeDepositModal()" aria-label="Close deposit funds modal">×</button>
    <h3>Deposit Funds</h3>
    <app-currency-store [playerId]="playerId"></app-currency-store>
  </div>
</div>
