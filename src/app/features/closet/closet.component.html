<ng-container *ngIf="closet | filterByType: filterType as filteredItems">
  <section class="closet-wrapper">
    <div class="closet-hero">
      <div class="hero-text">
        <p class="hero-kicker">Fashion Vault</p>
        <h2>Wardrobe Control Center</h2>
        <p class="hero-subtitle">
          Spin the bingo wheel, unlock rewards, and hang them proudly on your neon rail.
        </p>
        <div class="closet-controls">
          <div class="control-chip">
            <span>Player ID</span>
            <strong>{{ playerId || 'â€”' }}</strong>
          </div>
          <button class="ghost-btn" (click)="loadCloset()" title="Refresh closet">
            Refresh Closet
          </button>
        </div>
        <div class="filter-bar">
          <button (click)="filterType='all'" [class.active]="filterType==='all'">All</button>
          <button (click)="filterType='Shirt'" [class.active]="filterType==='Shirt'">Shirts</button>
          <button (click)="filterType='Pants'" [class.active]="filterType==='Pants'">Pants</button>
          <button (click)="filterType='Shoes'" [class.active]="filterType==='Shoes'">Shoes</button>
          <button (click)="filterType='Hat'" [class.active]="filterType==='Hat'">Hats</button>
          <button (click)="filterType='Accessory'" [class.active]="filterType==='Accessory'">Accessories</button>
          <button (click)="filterType='Bag'" [class.active]="filterType==='Bag'">Purses</button>
          <button (click)="filterType='Necklace'" [class.active]="filterType==='Necklace'">Necklaces</button>
          <button (click)="filterType='Dress'" [class.active]="filterType==='Dress'">Dresses</button>
        </div>
      </div>
      <div class="hero-bubble">
        <p>Latest action</p>
        <strong>{{ lastActionMessage || 'Waiting for your next outfit!' }}</strong>
        <span class="sparkle sparkle-one"></span>
        <span class="sparkle sparkle-two"></span>
      </div>
    </div>
  </section>

  <section class="closet-stage">
    <div class="closet-door left-door">
      <div class="door-panel"></div>
      <div class="door-knob"></div>
    </div>

    <div class="closet-interior">
      <p class="closet-label">Tap a hanger to equip</p>

      <div *ngIf="closetSlots.length === 0" class="closet-empty">
        <p>No treasures on this rail{{ filterType !== 'all' ? ' for this type yet.' : 'â€¦ keep playing!' }}</p>
        <button (click)="loadCloset()">Check again</button>
      </div>

      <div class="closet-rail" *ngIf="(closetSlots | filterByType: filterType).length > 0">
        <div
          class="closet-hanger"
          *ngFor="let slot of closetSlots | filterByType: filterType"
          [class.in-use]="slot.inUse">
          <div class="hanger-wire"></div>
          <div class="hanger-hook"></div>
          <div class="hanger-tag" *ngIf="slot.item">{{ slot.item.rarity | titlecase }}</div>
          <div class="item-card" *ngIf="slot.item && !slot.inUse; else hangerPlaceholder" [ngClass]="{'gold-skirt': slot.item?.name === 'Gold Skirt'}">
            <img [src]="closetService.getImageSrc(slot.item)" [alt]="slot.item.name" />
            <p class="item-name">{{ slot.item.name }}</p>
            <p class="item-type">{{ slot.item.type }}</p>
            <button (click)="equipItem(slot.item)">Equip</button>
          </div>
        </div>
      </div>
    </div>

    <div class="closet-door right-door">
      <div class="door-panel"></div>
      <div class="door-knob"></div>
    </div>
  </section>

  <section class="closet-bottom">
    <div class="wardrobe-column mannequin-col" *ngIf="closet.length > 0">
      <h3>Runway Preview</h3>
      <div class="mannequin-stage">
        <div class="mannequin-display">
          <div class="mannequin-base">
            <div class="base-avatar"></div>
            <ng-container *ngIf="getEquippedForTypes(topSlotTypes) as topSlot">
              <div class="layer-wrapper">
                <img
                  [src]="closetService.getImageSrc(topSlot.item)"
                  class="layer shirt"
                  [attr.data-item-name]="topSlot.item?.name" />
                <button
                  type="button"
                  class="unequip-btn"
                  *ngIf="!outfitLocked"
                  (click)="unequip(topSlot.type)"
                  aria-label="Remove top">
                  Ã—
                </button>
              </div>
            </ng-container>
            <div class="layer-wrapper" *ngIf="mannequin.equippedItems['Dress']">
              <img
                [src]="closetService.getImageSrc(mannequin.equippedItems['Dress'])"
                class="layer dress" />
              <button
                type="button"
                class="unequip-btn"
                *ngIf="!outfitLocked"
                (click)="unequip('Dress')"
                aria-label="Remove dress">
                Ã—
              </button>
            </div>
            <div class="layer-wrapper" *ngIf="mannequin.equippedItems['Pants']">
              <img
                [src]="closetService.getImageSrc(mannequin.equippedItems['Pants'])"
                class="layer pants"
                [attr.data-item-name]="mannequin.equippedItems['Pants']?.name" />
              <button
                type="button"
                class="unequip-btn"
                *ngIf="!outfitLocked"
                (click)="unequip('Pants')"
                aria-label="Remove pants">
                Ã—
              </button>
            </div>
            <div class="layer-wrapper" *ngIf="mannequin.equippedItems['Hat']">
              <img
                [src]="closetService.getImageSrc(mannequin.equippedItems['Hat'])"
                class="layer hat"
                [attr.data-item-name]="mannequin.equippedItems['Hat']?.name" />
              <button
                type="button"
                class="unequip-btn"
                *ngIf="!outfitLocked"
                (click)="unequip('Hat')"
                aria-label="Remove hat">
                Ã—
              </button>
            </div>
          </div>
        </div>
        <div class="side-accessories">
          <div class="side-slot">
            <p class="slot-label">Purse</p>
            <div class="side-item" *ngIf="mannequin.equippedItems['Bag']">
              <img [src]="closetService.getImageSrc(mannequin.equippedItems['Bag'])" class="side-image" />
              <button
                type="button"
                class="unequip-btn side"
                *ngIf="!outfitLocked"
                (click)="unequip('Bag')"
                aria-label="Remove purse">
                Ã—
              </button>
            </div>
            <div class="slot-placeholder" *ngIf="!mannequin.equippedItems['Bag']">Tap a purse to equip</div>
          </div>
          <div class="side-slot">
            <p class="slot-label">Shoes</p>
            <div class="side-item" *ngIf="mannequin.equippedItems['Shoes']">
              <img [src]="closetService.getImageSrc(mannequin.equippedItems['Shoes'])" class="side-image" />
              <button
                type="button"
                class="unequip-btn side"
                *ngIf="!outfitLocked"
                (click)="unequip('Shoes')"
                aria-label="Remove shoes">
                Ã—
              </button>
            </div>
            <div class="slot-placeholder" *ngIf="!mannequin.equippedItems['Shoes']">Step into heels or sneakers</div>
          </div>
          <div class="side-slot">
            <p class="slot-label">Necklace</p>
            <div class="side-item" *ngIf="mannequin.equippedItems['Necklace']">
              <img [src]="closetService.getImageSrc(mannequin.equippedItems['Necklace'])" class="side-image" />
              <button
                type="button"
                class="unequip-btn side"
                *ngIf="!outfitLocked"
                (click)="unequip('Necklace')"
                aria-label="Remove necklace">
                Ã—
              </button>
            </div>
            <div class="slot-placeholder" *ngIf="!mannequin.equippedItems['Necklace']">Add a necklace</div>
          </div>
        </div>
      </div>
      <p class="mannequin-tip">
        Equip a full look (Shirt, Pants, Shoes, Hat, Necklace) to hit the Hall of Fame!
      </p>
    </div>

    <div class="wardrobe-column status-col">
      <h3>Closet Notes</h3>
      <ul class="status-list">
        <li>
          <span>Total Pieces</span>
          <strong>{{ closet.length }}</strong>
        </li>
        <li>
          <span>Showing</span>
          <strong>{{ filteredItems.length }} {{ filterType | titlecase }}</strong>
        </li>
        <li>
          <span>Player ID</span>
          <strong>{{ playerId || 'Not set' }}</strong>
        </li>
      </ul>
      <p class="status-hint">Need more pieces? Score Bingos to unlock rewards!</p>
    </div>
  </section>
</ng-container>
      <ng-template #hangerPlaceholder>
        <div class="item-card placeholder">
          <div class="placeholder-icon">ðŸ§¥</div>
          <p class="placeholder-text">On the mannequin</p>
        </div>
      </ng-template>
